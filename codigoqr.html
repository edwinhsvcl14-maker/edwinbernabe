<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Escáner QR: Cámara Trasera Forzada (Render)</title>
    
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    
    <style>
        /* ... (Estilos CSS simplificados) ... */
        body {    
            display: flex;    
            justify-content: center;    
            flex-direction: column; 
            align-items: center; 
            margin: 0;    
            padding: 20px 0;
            min-height: 100vh;    
            box-sizing: border-box;    
            text-align: center;    
            background: rgb(128 0 0 / 66%);
            font-family: Arial, sans-serif;
        }
        .container {    
            width: 100%;    
            max-width: 500px;    
            margin: 5px;
        }
        .container h1 {    
            color: #ffffff;
        }
        .section {    
            background-color: #ffffff;    
            padding: 20px 30px; 
            border: 1.5px solid #b2b2b2;    
            border-radius: 0.25em;    
            box-shadow: 0 20px 25px rgba(0, 0, 0, 0.25);
        }
        /* Contenedor del visor (siempre visible para .render()) */
        #my-qr-reader {    
            padding: 20px !important;    
            border: 1.5px solid #b2b2b2 !important;    
            border-radius: 8px;
            min-height: 250px;
        }
        /* Ocultamos el botón de inicio de los ejemplos anteriores */
        #startButton, #statusMessage {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Scan QR Codes</h1>
        
        <div id="statusMessage">Iniciando escáner...</div>
        
        <div class="section">
            <div id="my-qr-reader">
                </div>
        </div>
    </div>

    <script>
        const statusMessage = document.getElementById('statusMessage');

        function onScanSuccess(decodeText, decodeResult) {
            alert("✅ QR Code Escaneado: " + decodeText);
            // CLAVE: No llamamos a .clear() o .stop(), el escáner se queda activo.
        }

        function onScanFailure(error) {
            // El escáner continuará intentando escanear
        }

        // ⭐️ CLAVE 1: Usamos Html5QrcodeScanner, que tiene el método .render()
        let html5QrcodeScanner = new Html5QrcodeScanner(
            "my-qr-reader", // ID del contenedor
            { 
                // Configuración
                fps: 10,
                qrbox: { width: 250, height: 250 },
                
                // ⭐️ CLAVE 2: Forzar la cámara trasera y deshabilitar el fallback de archivo
                disableFlip: true, // Deshabilita el botón de voltear cámara
                rememberLastUsedCamera: false, // No recordamos configuraciones previas
                
                // Forzar el inicio de la cámara trasera
                supportedScanTypes: [
                    Html5QrcodeScanType.SCAN_TYPE_CAMERA
                ],
                cameraConfig: {
                    facingMode: "environment" // La configuración que sí funcionó en nativo
                }
            },
            false // verbose=false
        );

        // 3. Iniciar el renderizado automático
        html5QrcodeScanner.render(onScanSuccess, onScanFailure);

        // Ocultar el mensaje de estado si el escáner logra cargar el visor
        document.addEventListener('DOMContentLoaded', () => {
            // Se asume que si el lector aparece, el mensaje de estado no es necesario
            const readerDiv = document.getElementById('my-qr-reader');
            if (readerDiv.querySelector('video')) {
                statusMessage.style.display = 'none';
            }
        }, 3000); // Esperamos 3 segundos para que cargue
    </script>
</body>
</html>
