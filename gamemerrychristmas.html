<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Navidad M√°gica</title>
    <link href="https://fonts.googleapis.com/css2?family=Mountains+of+Christmas:wght@700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --verde-profundo: #062e1e;
            --verde-alegre: #0a5d38;
            --oro: #f9c74f;
            --oro-metal: linear-gradient(45deg, #bf953f, #fcf6ba, #b38728, #fbf5b7, #aa771c);
        }

        /* --- RESET Y RESPONSIVE --- */
        * { box-sizing: border-box; }
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            background: radial-gradient(circle, var(--verde-alegre) 0%, var(--verde-profundo) 100%);
            font-family: 'Playfair Display', serif;
            color: white; overflow: hidden;
            display: flex; align-items: center; justify-content: center;
            touch-action: manipulation;
        }

        /* --- BOT√ìN DE M√öSICA --- */
        #music-toggle {
            position: fixed; top: 15px; right: 15px;
            width: 55px; height: 55px; border-radius: 50%;
            background: var(--oro-metal);
            border: 2px solid white; z-index: 9999; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            font-size: 26px; box-shadow: 0 4px 15px rgba(0,0,0,0.4);
        }

        /* --- PRELOADER GIGANTE --- */
        #preloader { 
            position: fixed; inset: 0; background: var(--verde-profundo); 
            z-index: 10000; display: flex; flex-direction: column; 
            align-items: center; justify-content: center; 
        }
        .tree-preloader {
            font-size: 180px; /* 3 veces m√°s grande */
            filter: drop-shadow(0 0 30px var(--oro));
            animation: pulse-gold 1.5s ease-in-out infinite;
            margin-bottom: 20px;
        }

        /* --- CONTENEDORES --- */
        .container {
            width: 90%; max-width: 400px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            text-align: center; z-index: 10;
        }

        .card { 
            background: rgba(255, 255, 255, 0.12); 
            backdrop-filter: blur(15px); 
            border: 2px solid var(--oro); 
            padding: 30px 20px; border-radius: 35px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            width: 100%;
        }

        h1 { 
            font-family: 'Mountains of Christmas', cursive; 
            font-size: 2.2rem; color: var(--oro); margin-bottom: 15px;
            line-height: 1.2;
        }

        /* --- JUEGO --- */
        canvas { 
            border: 3px solid var(--oro); border-radius: 20px; 
            background: rgba(0,0,0,0.4); 
            width: 100%; max-width: 300px; height: auto; aspect-ratio: 4/5;
            touch-action: none;
        }

        .btn-oro {
            background: var(--oro-metal); color: #4a3701; border: none;
            padding: 18px 30px; border-radius: 50px; font-weight: bold; 
            font-size: 1rem; cursor: pointer; margin-top: 15px; 
            text-transform: uppercase; width: 100%;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        .snowflake { position: fixed; top: -10px; color: white; z-index: 1000; pointer-events: none; animation: fall linear infinite; }
        @keyframes fall { to { transform: translateY(105vh) rotate(360deg); } }
        @keyframes pulse-gold { 0%, 100% { transform: scale(1); opacity: 0.8; } 50% { transform: scale(1.1); opacity: 1; } }

        /* --- RESPONSIVE PEQUE√ëO --- */
        @media (max-height: 600px) {
            h1 { font-size: 1.8rem; }
            .tree-preloader { font-size: 120px; }
            .card { padding: 15px; }
        }
    </style>
</head>
<body>

    <audio id="bg-audio" loop>
        <source src="https://edwinhsvcl14-maker.github.io/edwinbernabe/M√∫sica_NAVIDAD_instrumental.mp3" type="audio/mpeg">
    </audio>

    <div id="music-toggle" class="music-off" onclick="toggleMusic()">üîá</div>

    <div id="preloader">
        <div class="tree-preloader">üéÑ</div>
        <p style="color:var(--oro); font-family:'Mountains of Christmas'; font-size: 1.5rem; letter-spacing: 2px;">CARGANDO MAGIA...</p>
    </div>

    <div id="start-screen" class="container" style="display: none;">
        <div class="card">
            <img src="https://edwinhsvcl14-maker.github.io/edwinbernabe/papanoel.png" style="width:100px; margin-bottom: 10px;">
            <h1>¬°Holaaaaaa!</h1>
            <p>Edwin te ha puesto un reto navide√±o: atrapa 10 regalos para obtener tu sorpresa.</p>
            <p style="font-size: 0.8rem; color: var(--oro);">(Usa la campana arriba para activar la m√∫sica)</p>
            <button class="btn-oro" onclick="irAlJuego()">¬°Jugar ahora!</button>
        </div>
    </div>

    <div id="game-area" class="container" style="display:none;">
        <h2 style="font-family:'Mountains of Christmas'; color: var(--oro); font-size: 2rem; margin: 0 0 10px 0;">Regalos: <span id="score">0</span>/10</h2>
        <canvas id="gameCanvas"></canvas>
    </div>

    <div id="final-screen" class="container" style="display:none;">
        <div class="card">
            <h1 style="font-size: 1.6rem;">¬°FELIZ NAVIDAD Y PR√ìSPERO A√ëO NUEVO!</h1>
            <p style="font-size: 0.9rem;">Que la magia de la navidad permanezca en tu coraz√≥n. ¬°Dios te bendiga!</p>
            <div class="tree-blink" style="font-size: 60px; margin: 10px 0;">üéÅ</div>
            <p>Tu regalo est√° listo.</p>
            <button class="btn-oro" id="download-btn" onclick="descargarConMagia()">‚ú® Descargar Regalo ‚ú®</button>
        </div>
    </div>

    <script>
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let audioCtx, active = false;
        let musicEnabled = false;
        const bgAudio = document.getElementById('bg-audio');

        function toggleMusic() {
            if (!audioCtx) audioCtx = new AudioContext();
            if (audioCtx.state === 'suspended') audioCtx.resume();
            musicEnabled = !musicEnabled;
            const btn = document.getElementById('music-toggle');
            if (musicEnabled) {
                btn.innerHTML = "üîî";
                bgAudio.play();
                bgAudio.volume = 0.4;
            } else {
                btn.innerHTML = "üîá";
                bgAudio.pause();
            }
        }

        function playNote(f, d, v = 0.05, t = 'sine') {
            if(!audioCtx || !musicEnabled) return;
            const o = audioCtx.createOscillator();
            const g = audioCtx.createGain();
            o.type = t; o.frequency.value = f;
            g.gain.setValueAtTime(v, audioCtx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + d);
            o.connect(g); g.connect(audioCtx.destination);
            o.start(); o.stop(audioCtx.currentTime + d);
        }

        function descargarConMagia() {
            const btn = document.getElementById('download-btn');
            btn.innerHTML = "¬°ABRIENDO...! üéÑ";
            for (let i = 0; i < 40; i++) crearParticulaMagica();
            if (musicEnabled) {
                [523, 659, 783, 1046, 1318].forEach((f, idx) => {
                    setTimeout(() => playNote(f, 0.6, 0.15, 'triangle'), idx * 100);
                });
            }
            const link = document.createElement('a');
            link.href = 'https://edwinhsvcl14-maker.github.io/edwinbernabe/tarjetasaludo.mp4';
            link.download = 'Sorpresa_De_Edwin.mp4';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            setTimeout(() => { btn.innerHTML = "¬°CON CARI√ëO! ‚ù§Ô∏è"; }, 2000);
        }

        function crearParticulaMagica() {
            const p = document.createElement('div');
            const emojis = ['‚ú®', '‚≠ê', 'üéä', 'üéÅ', '‚ùÑÔ∏è'];
            p.innerHTML = emojis[Math.floor(Math.random() * emojis.length)];
            p.style.position = 'fixed'; p.style.left = '50%'; p.style.top = '60%';
            p.style.fontSize = '25px'; p.style.zIndex = '10000';
            p.style.transition = 'all 2s ease-out';
            document.body.appendChild(p);
            const tx = (Math.random() - 0.5) * 400;
            const ty = (Math.random() - 0.5) * 600 - 150;
            requestAnimationFrame(() => {
                p.style.transform = `translate(${tx}px, ${ty}px) rotate(360deg)`;
                p.style.opacity = '0';
            });
            setTimeout(() => p.remove(), 2000);
        }

        function irAlJuego() {
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('game-area').style.display = 'flex';
            canvas.width = 280; canvas.height = 350;
            active = true; spawn(); loop();
        }

        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let pts = 0, gifts = [];

        function spawn() { if(active) { gifts.push({x: Math.random()*240, y: -40}); setTimeout(spawn, 900); } }

        function loop() {
            if(!active) return;
            ctx.clearRect(0,0,280,350);
            gifts.forEach((g, i) => {
                g.y += 4; ctx.font = "40px Arial"; ctx.fillText("üéÅ", g.x, g.y);
                if(g.y > 350) gifts.splice(i, 1);
            });
            requestAnimationFrame(loop);
        }

        canvas.onpointerdown = (e) => {
            const r = canvas.getBoundingClientRect();
            const scaleX = canvas.width / r.width;
            const scaleY = canvas.height / r.height;
            const mx = ((e.clientX || (e.touches && e.touches[0].clientX)) - r.left) * scaleX;
            const my = ((e.clientY || (e.touches && e.touches[0].clientY)) - r.top) * scaleY;
            gifts.forEach((g, i) => {
                if(mx > g.x && mx < g.x+40 && my > g.y-40 && my < g.y) {
                    gifts.splice(i, 1); pts++;
                    playNote(880, 0.2, 0.1, 'triangle');
                    document.getElementById('score').innerText = pts;
                    if(pts >= 10) {
                        active = false;
                        if(musicEnabled) {
                            bgAudio.pause();
                            [523, 659, 783, 1046].forEach((f, idx) => setTimeout(() => playNote(f, 0.8, 0.1, 'square'), idx * 150));
                        }
                        document.getElementById('game-area').style.display = 'none';
                        document.getElementById('final-screen').style.display = 'flex';
                    }
                }
            });
        };

        window.onload = () => { setTimeout(() => { document.getElementById('preloader').style.display = 'none'; document.getElementById('start-screen').style.display = 'flex'; }, 3000); };
        setInterval(() => {
            const f = document.createElement('div');
            f.className = 'snowflake'; f.innerHTML = '‚ùÑ';
            f.style.left = Math.random() * 100 + 'vw';
            f.style.opacity = Math.random();
            f.style.animationDuration = Math.random() * 3 + 2 + 's';
            document.body.appendChild(f);
            setTimeout(() => f.remove(), 5000);
        }, 300);
    </script>
</body>
</html>
